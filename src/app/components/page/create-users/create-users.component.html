<!-- Titre Nav -->
<mat-toolbar color="primary">
  <mat-toolbar-row>
    <button mat-icon-button (click)="onHamburger.emit()"><mat-icon>menu</mat-icon></button> <span class="ml-2">Liste des utilisateurs</span>
  </mat-toolbar-row>
</mat-toolbar>




<!-- Barre de Recherche -->
<div class="contentPage row m-3 h-100">
  <div class="col-sm-4 pl-1 h-100 overflow-hidden">
    <mat-card class="mb-3 py-2 pb-0">
      <mat-form-field class="w-100">
        <input type="text" matInput placeholder="Rechercher un utilisateur">
        <mat-icon matSuffix>filter_list</mat-icon>
      </mat-form-field>
    </mat-card>
    
    <!-- Liste des utilisateurs -->      
    <div class="h-100 w-100 d-flex" *ngIf="utilisateurListLoading">
      <mat-spinner [strokeWidth]="2" [diameter]="30" class="m-auto"></mat-spinner>
    </div>
    <mat-action-list class="scroll h-100 mb-3" *ngIf="!utilisateurListLoading">
      <mat-list-item (click)="selectUtilisateur(utilisateur, index)" *ngFor="let utilisateur of utilisateurs; let index = index">
        <mat-icon mat-list-icon>person</mat-icon>
        <h4 mat-line>{{ utilisateur.username | titlecase }}</h4>
      </mat-list-item>
    </mat-action-list>        

    <button mat-fab color="accent" (click)="addUtilisateur()">
        <mat-icon>add</mat-icon>
    </button>
  </div>
    
    
  <!-- Formulaire Ajout utilisateur -->
  <div class="col-8 h-100 d-flex flex-column">

    <div class="emptyState" *ngIf="!currentUtilisateur">
      <img src="../../../../assets/svg/illustrations/add-user.svg">
      <div class="subtitle">
        <h3>Aucun utilisateur selectionné.</h3>
        <button mat-button color="primary" (click)="addUtilisateur()">Ajouter un utilisateur</button>
      </div>
    </div>

    <form [formGroup]="utilisateurForm" *ngIf=(currentUtilisateur) (ngSubmit)="createMode ? exit('create') : exit('save')" class="h-100 d-flex flex-column background">

      <div class="row m-0">               
        <!-- Profil icon -->
        <div class="text-align-center w-30 m-auto pt-3">
          <img src="../assets/svg/illustrations/Profil_icon_black.svg" class="Profil_icon">
        </div>
  
        <!-- Identifiant utilisateur -->
        <mat-form-field class="col-12 mt-2 mb-2">
          <input matInput placeholder="Identifiant utilisateur" id="username" formControlName="username" required>
          <mat-error *ngIf="form.username.errors && form.username.errors.required">L'identifiant ne peux pas être vide</mat-error>
          <mat-error *ngIf="form.username.errors && form.username.errors.maxlength">L'identifiant ne doit pas dépasser les 20 caractères</mat-error>
        </mat-form-field>
        
        <!-- Mot de passe -->
        <mat-form-field class="col-12 mb-2">
          <input matInput placeholder="Mot de passe" [type]="passwordHide ? 'password' : 'text'" id="password" formControlName="password" required>
          <mat-icon matSuffix (click)="passwordHide = !passwordHide">{{passwordHide ? 'visibility_off' : 'visibility'}}</mat-icon>
          <mat-hint>Entre 6 et 20 caractères</mat-hint>
          <mat-error *ngIf="form.password.errors && form.password.errors.required">Le mot de passe ne peux pas être vide</mat-error>
          <mat-error *ngIf="form.password.errors && form.password.errors.maxlength">Le mot de passe ne doit pas dépasser les 20 caractères</mat-error>
          <mat-error *ngIf="form.password.errors && form.password.errors.minlength">Le mot de passe doit faire au moins 6 caractères</mat-error>
        </mat-form-field>
        
        <!-- Administrateur oui/non -->      
        <mat-slide-toggle class="col-12 mb-2 mt-2" id="admin" formControlName="admin">Administrateur
        </mat-slide-toggle>
      </div>
      
      <!-- Boutons -->
      <div class="d-flex w-100 mt-auto mb-3" *ngIf=(createMode)>
        <button mat-stroked-button class="ml-auto mr-3" type="button" (click)="exit()">Annuler</button>
        <button mat-raised-button color="primary" type="submit" [disabled]="!utilisateurForm.valid">
          <mat-icon class="md-18">add</mat-icon> Ajouter
        </button>
      </div>

      <div class="d-flex w-100 mt-auto mb-3" *ngIf=(!createMode)>
        <button mat-button color="warn" class="mr-auto" (click)="delete()">Supprimer le client</button>
        <button mat-stroked-button class="mr-3" type="button" *ngIf=(utilisateurForm.dirty) (click)="exit()">Annuler</button>
        <button mat-raised-button color="primary" type="submit" *ngIf=(utilisateurForm.dirty) [disabled]="!utilisateurForm.valid">
          <mat-icon class="md-18">save</mat-icon> Enregister
        </button>
      </div>

    </form>
    
  </div>
</div>
